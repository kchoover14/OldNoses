options(width = 250)
options(max.print = .Machine$integer.max)

library(dplyr); library(Biostrings)

or1a1.aa = readAAStringSet("or1a1-aa.fas")
or1c1.aa = readAAStringSet("or1c1-aa.fas")
or2a25.aa = readAAStringSet("or2a25-aa.fas")
or2b11.aa = readAAStringSet("or2b11-aa.fas")
or2c1.aa = readAAStringSet("or2c1-aa.fas")
or2j2.aa = readAAStringSet("or2j2-aa.fas")
or2j3.aa = readAAStringSet("or2j3-aa.fas")
or2w1.aa = readAAStringSet("or2w1-aa.fas")
or4e2.aa = readAAStringSet("or4e2-aa.fas")
or4q3.aa = readAAStringSet("or4q3-aa.fas")
or5a1.aa = readAAStringSet("or5a1-aa.fas")
or5an1.aa = readAAStringSet("or5an1-aa.fas")
or5k1.aa = readAAStringSet("or5k1-aa.fas")
or5p3.aa = readAAStringSet("or5p3-aa.fas")
or6p1.aa = readAAStringSet("or6p1-aa.fas")
or7c1.aa = readAAStringSet("or7c1-aa.fas")
or7d4.aa = readAAStringSet("or7d4-aa.fas")
or8b3.aa = readAAStringSet("or8b3-aa.fas")
or8d1.aa = readAAStringSet("or8d1-aa.fas")
or8k3.aa = readAAStringSet("or8k3-aa.fas")
or10a6.aa = readAAStringSet("or10a6-aa.fas")
or10g3.aa = readAAStringSet("or10g3-aa.fas")
or10g4.aa = readAAStringSet("or10g4-aa.fas")
or10g7.aa = readAAStringSet("or10g7-aa.fas")
or10j5.aa = readAAStringSet("or10j5-aa.fas")
or11a1.aa = readAAStringSet("or11a1-aa.fas")
or51e1.aa = readAAStringSet("or51e1-aa.fas")
or51e2.aa = readAAStringSet("or51e2-aa.fas")
or51l1.aa = readAAStringSet("or51l1-aa.fas")
or56a4.aa = readAAStringSet("or56a4-aa.fas")

#function and code from:
#https://stackoverflow.com/questions/48402460/identifying-amino-acid-substitutions-from-local-alignments-in-r
mismatches <- function(query, ref) {
  pairwiseAlignment(ref, query, substitutionMatrix = "BLOSUM100",
                    gapOpening = 3, gapExtension = 1) %>%
    mismatchTable() %>%
    mutate(ID=names(query),
           Pos=PatternStart,
           Reference_AA=as.character(PatternSubstring),
           Sample_AA=as.character(SubjectSubstring)) %>%
    select(ID, Reference_AA, Sample_AA, Pos)
}

bind_rows(mismatches(or1a1.aa[2], or1a1.aa[1]), mismatches(or1a1.aa[2], or1a1.aa[1]))
bind_rows(mismatches(or1c1.aa[2], or1c1.aa[1]), mismatches(or1c1.aa[2], or1c1.aa[1]))
bind_rows(mismatches(or2a25.aa[2], or2a25.aa[1]), mismatches(or2a25.aa[2], or2a25.aa[1]))
bind_rows(mismatches(or2b11.aa[2], or2b11.aa[1]), mismatches(or2b11.aa[2], or2b11.aa[1]))
bind_rows(mismatches(or2c1.aa[2], or2c1.aa[1]), mismatches(or2c1.aa[2], or2c1.aa[1]))
bind_rows(mismatches(or2j2.aa[2], or2j2.aa[1]), mismatches(or2j2.aa[2], or2j2.aa[1]))
bind_rows(mismatches(or2j3.aa[2], or2j3.aa[1]), mismatches(or2j3.aa[2], or2j3.aa[1]))
bind_rows(mismatches(or2w1.aa[2], or2w1.aa[1]), mismatches(or2w1.aa[2], or2w1.aa[1]))
bind_rows(mismatches(or4e2.aa[2], or4e2.aa[1]), mismatches(or4e2.aa[2], or4e2.aa[1]))
bind_rows(mismatches(or4q3.aa[2], or4q3.aa[1]), mismatches(or4q3.aa[2], or4q3.aa[1]))
bind_rows(mismatches(or5a1.aa[2], or5a1.aa[1]), mismatches(or5a1.aa[2], or5a1.aa[1]))
bind_rows(mismatches(or5an1.aa[2], or5an1.aa[1]), mismatches(or5an1.aa[2], or5an1.aa[1]))
bind_rows(mismatches(or5k1.aa[2], or5k1.aa[1]), mismatches(or5k1.aa[2], or5k1.aa[1]))
bind_rows(mismatches(or5p3.aa[2], or5p3.aa[1]), mismatches(or5p3.aa[2], or5p3.aa[1]))
bind_rows(mismatches(or6p1.aa[2], or6p1.aa[1]), mismatches(or6p1.aa[2], or6p1.aa[1]))
bind_rows(mismatches(or7c1.aa[2], or7c1.aa[1]), mismatches(or7c1.aa[2], or7c1.aa[1]))
bind_rows(mismatches(or7d4.aa[2], or7d4.aa[1]), mismatches(or7d4.aa[2], or7d4.aa[1]))
bind_rows(mismatches(or8b3.aa[2], or8b3.aa[1]), mismatches(or8b3.aa[2], or8b3.aa[1]))
bind_rows(mismatches(or8d1.aa[2], or8d1.aa[1]), mismatches(or8d1.aa[2], or8d1.aa[1]))
bind_rows(mismatches(or8k3.aa[2], or8k3.aa[1]), mismatches(or8k3.aa[2], or8k3.aa[1]))
bind_rows(mismatches(or10a6.aa[2], or10a6.aa[1]), mismatches(or10a6.aa[2], or10a6.aa[1]))
bind_rows(mismatches(or10g3.aa[2], or10g3.aa[1]), mismatches(or10g3.aa[2], or10g3.aa[1]))
bind_rows(mismatches(or10g4.aa[2], or10g4.aa[1]), mismatches(or10g4.aa[2], or10g4.aa[1]))
bind_rows(mismatches(or10g7.aa[2], or10g7.aa[1]), mismatches(or10g7.aa[2], or10g7.aa[1]))
bind_rows(mismatches(or10j5.aa[2], or10j5.aa[1]), mismatches(or10j5.aa[2], or10j5.aa[1]))
bind_rows(mismatches(or11a1.aa[2], or11a1.aa[1]), mismatches(or11a1.aa[2], or11a1.aa[1]))
bind_rows(mismatches(or51e1.aa[2], or51e1.aa[1]), mismatches(or51e1.aa[2], or51e1.aa[1]))
bind_rows(mismatches(or51e2.aa[2], or51e2.aa[1]), mismatches(or51e2.aa[2], or51e2.aa[1]))
bind_rows(mismatches(or51l1.aa[2], or51l1.aa[1]), mismatches(or51l1.aa[2], or51l1.aa[1]))
bind_rows(mismatches(or56a4.aa[2], or56a4.aa[1]), mismatches(or56a4.aa[2], or56a4.aa[1]))

sink("substitutions-amino acid-raw data.txt", append=FALSE)
bind_rows(lapply(seq_along(or1a1.aa[-1]), function(i) mismatches(or1a1.aa[i+1], or1a1.aa[1])))
bind_rows(lapply(seq_along(or1c1.aa[-1]), function(i) mismatches(or1c1.aa[i+1], or1c1.aa[1])))
bind_rows(lapply(seq_along(or2a25.aa[-1]), function(i) mismatches(or2a25.aa[i+1], or2a25.aa[1])))
bind_rows(lapply(seq_along(or2b11.aa[-1]), function(i) mismatches(or2b11.aa[i+1], or2b11.aa[1])))
bind_rows(lapply(seq_along(or2c1.aa[-1]), function(i) mismatches(or2c1.aa[i+1], or2c1.aa[1])))
bind_rows(lapply(seq_along(or2j2.aa[-1]), function(i) mismatches(or2j2.aa[i+1], or2j2.aa[1])))
bind_rows(lapply(seq_along(or2j3.aa[-1]), function(i) mismatches(or2j3.aa[i+1], or2j3.aa[1])))
bind_rows(lapply(seq_along(or2w1.aa[-1]), function(i) mismatches(or2w1.aa[i+1], or2w1.aa[1])))
bind_rows(lapply(seq_along(or4e2.aa[-1]), function(i) mismatches(or4e2.aa[i+1], or4e2.aa[1])))
bind_rows(lapply(seq_along(or4q3.aa[-1]), function(i) mismatches(or4q3.aa[i+1], or4q3.aa[1])))
bind_rows(lapply(seq_along(or5a1.aa[-1]), function(i) mismatches(or5a1.aa[i+1], or5a1.aa[1])))
bind_rows(lapply(seq_along(or5an1.aa[-1]), function(i) mismatches(or5an1.aa[i+1], or5an1.aa[1])))
bind_rows(lapply(seq_along(or5k1.aa[-1]), function(i) mismatches(or5k1.aa[i+1], or5k1.aa[1])))
bind_rows(lapply(seq_along(or5p3.aa[-1]), function(i) mismatches(or5p3.aa[i+1], or5p3.aa[1])))
bind_rows(lapply(seq_along(or6p1.aa[-1]), function(i) mismatches(or6p1.aa[i+1], or6p1.aa[1])))
bind_rows(lapply(seq_along(or7c1.aa[-1]), function(i) mismatches(or7c1.aa[i+1], or7c1.aa[1])))
bind_rows(lapply(seq_along(or7d4.aa[-1]), function(i) mismatches(or7d4.aa[i+1], or7d4.aa[1])))
bind_rows(lapply(seq_along(or8b3.aa[-1]), function(i) mismatches(or8b3.aa[i+1], or8b3.aa[1])))
bind_rows(lapply(seq_along(or8d1.aa[-1]), function(i) mismatches(or8d1.aa[i+1], or8d1.aa[1])))
bind_rows(lapply(seq_along(or8k3.aa[-1]), function(i) mismatches(or8k3.aa[i+1], or8k3.aa[1])))
bind_rows(lapply(seq_along(or10a6.aa[-1]), function(i) mismatches(or10a6.aa[i+1], or10a6.aa[1])))
bind_rows(lapply(seq_along(or10g3.aa[-1]), function(i) mismatches(or10g3.aa[i+1], or10g3.aa[1])))
bind_rows(lapply(seq_along(or10g4.aa[-1]), function(i) mismatches(or10g4.aa[i+1], or10g4.aa[1])))
bind_rows(lapply(seq_along(or10g7.aa[-1]), function(i) mismatches(or10g7.aa[i+1], or10g7.aa[1])))
bind_rows(lapply(seq_along(or10j5.aa[-1]), function(i) mismatches(or10j5.aa[i+1], or10j5.aa[1])))
bind_rows(lapply(seq_along(or11a1.aa[-1]), function(i) mismatches(or11a1.aa[i+1], or11a1.aa[1])))
bind_rows(lapply(seq_along(or51e1.aa[-1]), function(i) mismatches(or51e1.aa[i+1], or51e1.aa[1])))
bind_rows(lapply(seq_along(or51e2.aa[-1]), function(i) mismatches(or51e2.aa[i+1], or51e2.aa[1])))
bind_rows(lapply(seq_along(or51l1.aa[-1]), function(i) mismatches(or51l1.aa[i+1], or51l1.aa[1])))
bind_rows(lapply(seq_along(or56a4.aa[-1]), function(i) mismatches(or56a4.aa[i+1], or56a4.aa[1])))
sink()

